# Adalink ARM CPU Tool

Tool to automate flashing ARM CPUs with new program code usign a Segger J-link
device.

## Installation

### Install

On Linux and MacOS run: 

    sudo python setup.py install
  
On Windows run:

    python setup.py install

### Development Install (run from this folder)

You can also install in `develop` mode which will create a symlink to the code in this folder, meaning any changes made to the python code will take effect when running `adalink`.

On Linux and MacOS run:

    sudo python setup.py develop
  
On Windows run

    python setup.py develop

### Uninstall

To remove the tool you'll need to have the PIP python package manager installed.
You can install PIP by downloading and executing the script here:
  https://bootstrap.pypa.io/get-pip.py

Then run the following to unintall adalink:

    sudo pip uninstall adalink

Note on Windows the sudo part of the command should be omitted.

## Usage

For all systems you must have Segger's JLink tools installed on your system.
You can find these tools here: https://www.segger.com/jlink-software.html

You also must have the JLink tools in your system path.  On Windows the tools
are by default installed to C:\Program Files (x86)\SEGGER\JLink_V496h so add
that to your path.  On Linux and MacOSX the path is the location of download.

To check if JLink's tools are in your path, on Linux/MacOSX try running `JLinkExe`
or on Windows try running `JLink` in a command Window.

Once installed run the following command to see the usage information:

    adalink --help

In general you can use the tool to wipe a board and load it with any number of
.hex files.  For example to wipe a board and program it with a bootloader, SD,
app, and app signature hex file you can run from the root of the entire repo:

    adalink --core nrf51822 --wipe --program tools\Other\perl\flasher\Adafruit_BluefruitLE_Firmware\bootloader\bootloader_0000.hex tools\Other\perl\flasher\Adafruit_BluefruitLE_Firmware\s110_nrf51822_7.1.0_softdevice.hex projects\blefriend\_build\blefriend_s110_xxaa.hex projects\blefriend\_build\blefriend_s110_xxaa_signature.hex

You can also issue the `--info` command to try to retrieve basic info about the connected nRF51822 device, which can be done with the following command:

    adalink --core nrf51822 --info

... which should give you the following response (depending on the device connected to the J-Link):

    Hardware ID : QFACA10 (32KB)
    SD Version  : S110 8.0.0
    Device Addr : C1:99:FC:D9:8A:D1
    Device ID   : ****************

**Note:** Make sure the JLink device and board are connected and powered before running the command!

## Common Problems

### Windows Path Errors

If you get an error on Windows trying to run adalink (ex. `adalink --core nRF51822 --info`), you likely need to **add the Python Scripts folder** (ex `C:\PythonXX\Scripts`) to your system path so that Windows knows where to find the `adalink.exe` file generated by setup.py.

The exact path is displayed in the output when running setup.py, for example:

    Installing adalink-script.py script to C:\Python27\Scripts
    Installing adalink.exe script to C:\Python27\Scripts

If it isn't already present, you may also need to **add the J-Link binary folder** to your system path so that adalink can run JLink.exe, which is used to communicate with the J-Link via generated script files.

Depending on the version of the J-Link drivers you installed, the folder to add to your system path should resemble the following:

    C:\Program Files (x86)\SEGGER\JLink_V494f

# Extending AdaLink With New CPUs

adalink is built with a modular structure in mind and can be extended to support
new CPUs without much effort.  Look in the adalink/cores directory to see the
abstract base class and concrete core implementation files.  To add a new core
just add a new .py file in the directory, add to it a class that inherits from
the Core base class, and fill in implementations of the abstract functions.
See the nrf51822.py file for an example of a concrete implementation.
